<mat-card class="table-card">

  <app-cards 
  [totalUsers]="totalUsers" 
  [totalSalary]="totalSalary" 
  [averageSalary]="averageSalary" 
  [totalIncrementedSalary]="totalIncrementedSalary">
</app-cards>


  <!-- Add New User Button -->
  <button
    mat-raised-button
    color="primary"
    (click)="openUserDialog()"
    class="btns mt-2 mb-2"
  >
    <i class="fa-solid fa-plus"></i>
  </button>
  <mat-form-field appearance="fill">
    <mat-label>Search</mat-label>
    <input
      matInput
      (keyup)="applyFilter($event)"
      placeholder="Filter by name"
    />
  </mat-form-field>
  <div class="table-container">
    <table
      mat-table
      [dataSource]="dataSource"
      matSort
      class="mat-elevation-z8 responsive-table"
    >
      <!-- Name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
        <td mat-cell *matCellDef="let element">{{ element.name }}</td>
      </ng-container>

      <!-- Email Column -->
      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Email</th>
        <td mat-cell *matCellDef="let element">{{ element.email }}</td>
      </ng-container>

      <!-- Role Column -->
      <ng-container matColumnDef="role">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Role</th>
        <td mat-cell *matCellDef="let element">{{ element.role }}</td>
      </ng-container>

      <!-- Salary Column -->
      <ng-container matColumnDef="salary">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Salary</th>
        <td mat-cell *matCellDef="let element">
          {{ element.salary | currency }}
        </td>
      </ng-container>

      <!-- Salary Increment by 20% Column -->
      <ng-container matColumnDef="incrementedSalary">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          Salary Increment
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.incrementedSalary | currency }}
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="ml-2">Actions</th>
        <td mat-cell *matCellDef="let element; let i = index">
          <button mat-button color="primary" (click)="editUser(element, i)">
            Edit
          </button>
          <button mat-button color="warn" (click)="deleteUser(i)">
            Delete
          </button>
        </td>
      </ng-container>

      <!-- Header and Row Declarations -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>

  <!-- Paginator -->
  <mat-paginator
    [pageSizeOptions]="[5, 10, 20]"
    showFirstLastButtons
  ></mat-paginator>

  <!-- Dialog for Add/Edit User -->
  <ng-template #userDialog>
    <h2 mat-dialog-title class="mb-4">
      {{ isEditMode ? "Edit User" : "Add New User" }}
    </h2>
    <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
      <div class="container">
        <div class="row">
          <!-- First Column -->
          <div class="col-md-6 mb-3">
            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Name</mat-label>
              <input matInput formControlName="name" />
              <mat-error *ngIf="userForm.get('name')?.hasError('required')">
                Name is required.
              </mat-error>
            </mat-form-field>
          </div>
          <!-- Second Column -->
          <div class="col-md-6 mb-3">
            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Email</mat-label>
              <input matInput formControlName="email" />
              <mat-error *ngIf="userForm.get('email')?.hasError('required')">
                Email is required.
              </mat-error>
              <mat-error *ngIf="userForm.get('email')?.hasError('email')">
                Invalid email format.
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <div class="row">
          <!-- Third Column -->
          <div class="col-md-6 mb-3">
            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Role</mat-label>
              <input matInput formControlName="role" />
              <mat-error *ngIf="userForm.get('role')?.hasError('required')">
                Role is required.
              </mat-error>
            </mat-form-field>
          </div>
          <!-- Fourth Column -->
          <div class="col-md-6 mb-3">
            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Salary</mat-label>
              <input matInput type="number" formControlName="salary" />
              <mat-error *ngIf="userForm.get('salary')?.hasError('required')">
                Salary is required.
              </mat-error>
              <mat-error *ngIf="userForm.get('salary')?.hasError('min')">
                Salary must be greater than 0.
              </mat-error>
            </mat-form-field>
          </div>
        </div>
      </div>

      <div mat-dialog-actions class="mt-4">
        <button
          mat-button
          type="button"
          (click)="closeDialog()"
          class="btn btn-secondary"
        >
          Cancel
        </button>
        <button
          mat-raised-button
          color="primary"
          type="submit"
          class="btn btn-primary"
        >
          {{ isEditMode ? "Update" : "Add" }}
        </button>
      </div>
    </form>
  </ng-template>
  <app-charts></app-charts>
  <!-- <p>Total Users: {{totalUsers}}</p>
  <p>Total Salary: {{totalSalary | currency}}</p>
  <p>Average Salary: {{averageSalary | currency}}</p>
  <p>Total Incremented Salary: {{totalIncrementedSalary | currency}}</p> -->
</mat-card>
